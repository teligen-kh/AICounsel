import asyncio
from motor.motor_asyncio import AsyncIOMotorClient
from datetime import datetime

async def init_knowledge_base():
    """지식 베이스를 초기화하고 프로그램/키오스크/POS 관련 상담 데이터를 추가합니다."""
    
    # MongoDB 연결
    client = AsyncIOMotorClient("mongodb://localhost:27017/")
    db = client['aicounsel']
    
    # 지식 베이스 컬렉션
    knowledge_collection = db.knowledge_base
    
    # 기존 데이터 삭제
    await knowledge_collection.delete_many({})
    print("기존 지식 베이스 데이터를 삭제했습니다.")
    
    # 프로그램/키오스크/POS 관련 상담 지식 데이터
    knowledge_data = [
        {
            "question": "프린터 용지 출력이 안되고 빨간 불이 깜빡이는 문제",
            "answer": "프린터 용지 출력 문제와 빨간 불 깜빡임은 다음과 같은 원인들이 있을 수 있어요:\n\n1. 용지 걸림: 프린터 내부에 용지가 걸려있을 수 있습니다. 프린터를 끄고 용지함을 열어서 걸린 용지를 제거해주세요.\n2. 용지 부족: 용지함에 용지가 부족하거나 용지가 제대로 들어가지 않았을 수 있습니다. 용지를 다시 넣어주세요.\n3. 토너/잉크 부족: 토너나 잉크가 부족하면 빨간 불이 깜빡일 수 있습니다. 교체가 필요합니다.\n4. 카트리지 문제: 카트리지가 제대로 설치되지 않았거나 손상되었을 수 있습니다.\n5. 드라이버 문제: 프린터 드라이버를 재설치해보세요.\n\n먼저 프린터를 끄고 30초 후 다시 켜보시고, 그래도 해결되지 않으면 위의 항목들을 차례로 확인해보세요.",
            "keywords": ["프린터", "용지출력", "빨간불", "깜빡임", "용지걸림", "토너", "카트리지", "드라이버"],
            "category": "하드웨어",
            "created_at": datetime.now(),
            "updated_at": datetime.now()
        },
        {
            "question": "키오스크 터치가 안되는 문제",
            "answer": "키오스크 터치가 안되는 문제는 다음과 같은 방법으로 해결할 수 있어요:\n\n1. 화면 청소: 화면에 지문이나 먼지가 있으면 터치가 안될 수 있습니다. 부드러운 천으로 화면을 깨끗이 닦아주세요.\n2. 재부팅: 키오스크를 완전히 끄고 1분 후 다시 켜보세요.\n3. 터치 보정: 키오스크 설정에서 터치 보정을 실행해보세요.\n4. 연결 확인: 터치 스크린 케이블이 제대로 연결되어 있는지 확인하세요.\n5. 드라이버 업데이트: 터치 스크린 드라이버를 최신 버전으로 업데이트해보세요.\n6. 보호 필름 제거: 화면 보호 필름이 터치를 방해할 수 있습니다.\n\n대부분의 경우 재부팅으로 해결되니 먼저 시도해보시고, 그래도 안되면 위의 다른 방법들을 차례로 시도해보세요.",
            "keywords": ["키오스크", "터치", "화면", "재부팅", "보정", "드라이버", "보호필름"],
            "category": "키오스크",
            "created_at": datetime.now(),
            "updated_at": datetime.now()
        },
        {
            "question": "POS 시스템 결제 오류",
            "answer": "POS 시스템에서 결제 오류가 발생할 때 다음과 같이 해결할 수 있어요:\n\n1. 네트워크 연결 확인: 인터넷 연결이 안정적인지 확인하세요.\n2. 카드 리더기 재연결: 카드 리더기를 USB 포트에서 뽑았다가 다시 연결해보세요.\n3. POS 프로그램 재시작: POS 프로그램을 완전히 종료하고 다시 실행해보세요.\n4. 영수증 프린터 확인: 영수증 프린터에 용지가 있는지, 연결이 제대로 되어 있는지 확인하세요.\n5. 시스템 시간 확인: 컴퓨터 시간이 정확한지 확인하세요.\n6. 관리자 권한으로 실행: POS 프로그램을 관리자 권한으로 실행해보세요.\n\n오류 메시지가 나타나면 정확한 오류 내용을 알려주시면 더 구체적인 해결책을 제시해드릴 수 있어요.",
            "keywords": ["POS", "결제", "오류", "네트워크", "카드리더기", "영수증", "프린터", "관리자권한"],
            "category": "POS",
            "created_at": datetime.now(),
            "updated_at": datetime.now()
        },
        {
            "question": "프로그램 실행이 안되는 문제",
            "answer": "프로그램이 실행되지 않을 때 다음과 같은 방법을 시도해보세요:\n\n1. 재부팅: 컴퓨터를 완전히 재부팅해보세요.\n2. 관리자 권한으로 실행: 프로그램을 우클릭하고 '관리자 권한으로 실행'을 선택하세요.\n3. 바이러스 검사: 바이러스 백신 프로그램으로 검사를 실행해보세요.\n4. 프로그램 재설치: 프로그램을 완전히 삭제하고 다시 설치해보세요.\n5. Windows 업데이트: Windows 업데이트가 필요한지 확인하고 설치하세요.\n6. 호환성 모드: 프로그램 속성에서 호환성 모드를 설정해보세요.\n7. 오류 메시지 확인: 오류 메시지가 나타나면 정확한 내용을 확인해주세요.\n\n어떤 프로그램에서 문제가 발생하는지, 그리고 오류 메시지가 있다면 알려주시면 더 구체적인 도움을 드릴 수 있어요.",
            "keywords": ["프로그램", "실행", "재부팅", "관리자권한", "바이러스", "재설치", "업데이트", "호환성"],
            "category": "소프트웨어",
            "created_at": datetime.now(),
            "updated_at": datetime.now()
        },
        {
            "question": "키오스크 주문 취소 방법",
            "answer": "키오스크에서 주문을 취소하는 방법을 알려드릴게요:\n\n1. 주문 진행 중 취소: 주문 화면에서 '취소' 또는 '뒤로가기' 버튼을 눌러주세요.\n2. 결제 후 취소: 결제가 완료된 후에는 키오스크에서 직접 취소가 어려울 수 있어요. 매장 직원에게 말씀해주세요.\n3. 관리자 모드: 키오스크에 관리자 모드가 있다면 로그인 후 주문 내역에서 취소할 수 있어요.\n4. 영수증 확인: 영수증에 취소 관련 안내가 있을 수 있으니 확인해보세요.\n\n대부분의 키오스크는 결제 완료 전까지는 언제든지 취소가 가능하니, 결제 버튼을 누르기 전에 신중하게 확인해주세요. 결제 후에는 매장 정책에 따라 취소가 제한될 수 있어요.",
            "keywords": ["키오스크", "주문", "취소", "결제", "관리자", "영수증"],
            "category": "키오스크",
            "created_at": datetime.now(),
            "updated_at": datetime.now()
        },
        {
            "question": "POS 시스템 백업 방법",
            "answer": "POS 시스템 데이터를 백업하는 방법을 알려드릴게요:\n\n1. 자동 백업 설정: POS 프로그램 설정에서 자동 백업 기능을 활성화하세요.\n2. 수동 백업: POS 프로그램의 '백업' 메뉴에서 수동으로 백업을 실행할 수 있어요.\n3. 외부 저장장치: USB나 외장하드를 연결해서 백업 파일을 저장하세요.\n4. 클라우드 백업: 인터넷이 안정적이라면 클라우드 서비스에 백업하는 것도 좋은 방법이에요.\n5. 백업 주기: 매일 또는 매주 정기적으로 백업하는 것을 권장합니다.\n6. 백업 확인: 백업이 제대로 되었는지 백업 파일을 열어서 확인해보세요.\n\n백업 파일은 안전한 곳에 보관하고, 정기적으로 백업이 제대로 되고 있는지 확인하는 것이 중요해요.",
            "keywords": ["POS", "백업", "자동백업", "수동백업", "외장하드", "클라우드", "정기백업"],
            "category": "POS",
            "created_at": datetime.now(),
            "updated_at": datetime.now()
        },
        {
            "question": "견적서 엑셀 출력 시 내용이 짤리는 문제",
            "answer": "견적서를 엑셀로 저장할 때 내용이 짤리는 문제는 다음과 같은 방법으로 해결할 수 있어요:\n\n1. 셀 크기 조정: 엑셀에서 열 너비와 행 높이를 자동으로 조정해보세요. 데이터를 선택하고 '홈' 탭의 '서식'에서 '열 너비 자동 맞춤'을 선택하세요.\n2. 인쇄 영역 설정: '페이지 레이아웃' 탭에서 '인쇄 영역'을 설정하여 모든 내용이 포함되도록 하세요.\n3. 페이지 설정: '페이지 레이아웃' → '페이지 설정'에서 용지 방향을 가로로 변경하거나 축소 배율을 조정해보세요.\n4. 셀 병합 해제: 병합된 셀이 있다면 해제하고 개별 셀로 분리해보세요.\n5. 글꼴 크기 조정: 글꼴 크기를 줄여서 내용이 셀에 맞도록 조정하세요.\n6. 줄바꿈 설정: 셀에서 '자동 줄바꿈'을 활성화하여 긴 텍스트가 여러 줄로 표시되도록 하세요.\n\n대부분의 경우 셀 크기 자동 조정으로 해결되니 먼저 시도해보시고, 그래도 안되면 위의 다른 방법들을 차례로 시도해보세요.",
            "keywords": ["견적서", "엑셀", "출력", "짤림", "셀크기", "인쇄영역", "페이지설정", "줄바꿈"],
            "category": "소프트웨어",
            "created_at": datetime.now(),
            "updated_at": datetime.now()
        },
        {
            "question": "프로그램에서 엑셀 파일 저장 시 오류",
            "answer": "프로그램에서 엑셀 파일을 저장할 때 오류가 발생하는 경우 다음과 같이 해결할 수 있어요:\n\n1. 파일 권한 확인: 저장하려는 폴더에 쓰기 권한이 있는지 확인하세요.\n2. 파일이 열려있는지 확인: 저장하려는 엑셀 파일이 다른 프로그램에서 열려있다면 닫아주세요.\n3. 디스크 공간 확인: 하드디스크에 충분한 여유 공간이 있는지 확인하세요.\n4. 바이러스 검사: 바이러스 백신 프로그램이 파일 저장을 차단하고 있을 수 있습니다.\n5. 프로그램 재시작: 프로그램을 완전히 종료하고 다시 실행해보세요.\n6. 다른 이름으로 저장: '다른 이름으로 저장'을 사용해서 다른 위치에 저장해보세요.\n7. 관리자 권한으로 실행: 프로그램을 관리자 권한으로 실행해보세요.\n\n오류 메시지가 나타나면 정확한 내용을 확인해주시면 더 구체적인 해결책을 제시해드릴 수 있어요.",
            "keywords": ["프로그램", "엑셀", "파일저장", "오류", "권한", "디스크공간", "바이러스", "관리자권한"],
            "category": "소프트웨어",
            "created_at": datetime.now(),
            "updated_at": datetime.now()
        }
    ]
    
    # 지식 베이스에 데이터 삽입
    result = await knowledge_collection.insert_many(knowledge_data)
    print(f"지식 베이스에 {len(result.inserted_ids)}개의 항목을 추가했습니다.")
    
    # 추가된 데이터 확인
    count = await knowledge_collection.count_documents({})
    print(f"현재 지식 베이스 총 항목 수: {count}")
    
    # 샘플 데이터 출력
    print("\n추가된 지식 베이스 항목:")
    async for item in knowledge_collection.find({}):
        print(f"- {item['question']}")
    
    client.close()
    print("\n지식 베이스 초기화가 완료되었습니다.")

if __name__ == "__main__":
    asyncio.run(init_knowledge_base()) 